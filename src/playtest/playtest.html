<!DOCTYPE html>
<html>
<head>
  <title>Nightswim Editor - Story Preview</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' filesystem 'unsafe-inline'; img-src 'self' data:;">
  <meta name="viewport" content="initial-scale=1">
  <script src="../../lib/keypress-2.1.5.min.js"></script>
  <script>
    const {ipcRenderer, remote} = require("electron");
    ipcRenderer.on("playtest-loading-done", (event, path, windowId) => {
        console.log("new window: id is " + windowId);
        path = "file://" + path;
        console.log("Playtest path is " + path);

        const webview = document.querySelector("#playtestWebview");
        webview.loadURL(path);

        webview.addEventListener("dom-ready", () => {
            webview.openDevTools();

            let listener = new window.keypress.Listener();

            listener.simple_combo("meta w", function () {
                ipcRenderer.send("close-window-request", windowId);
            });

            listener.simple_combo("esc", function () {
                ipcRenderer.send("close-window-request", windowId);
            });

            listener.simple_combo("r", function () {
                ipcRenderer.send("reload-playtest", windowId);
            });
        })
    });
  </script>
</head>

<body style="margin: 0; padding: 0">
  <webview id="playtestWebview" style="width: 100vw; height: 100vh; margin: 0;
  padding: 0; border: 0;"></webview>
</body>
</html>